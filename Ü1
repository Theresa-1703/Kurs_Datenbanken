USE win24_voth76405_tm;
-- ToyModels_Create_Table.sql ohne USE-Befehl ausführen
-- ToyModels_Insert.sql ohne USE-Befehl ausführen
-- 2.a) Ermitteln Sie die maximale KundenNr in der Tabelle Kunden.
SELECT MAX(KundenNr) FROM Kunden;
-- b) Stellen Sie den PK der Tabelle Kunden mit obigen Anweisungen auf 
AUTO_INCREMENT um und
-- stellen Sie sicher, dass die nächste KundenNr um eins größer ist 
als die bisher größte.
SET foreign_key_checks=0;
ALTER TABLE Kunden MODIFY COLUMN KundenNr INT auto_increment;
ALTER TABLE Kunden AUTO_INCREMENT = 497;
SET foreign_key_checks=1;
-- c) Legen Sie einen Kunden an (Achtung, die KundenNr wird jetzt 
automatisch vergeben!)
INSERT INTO Kunden (Firma, Nachname, Vorname, Telefon, Strasse, Ort, PLZ, 
Land, Kundenbetreuer, Kreditlimit)
VALUES ('Happy Gifts','Meier','Carlos ','40.32.2555','11, Rue 
Croissant','Paris','44000','Frankreich','1337','2100.0');
-- d) Testen Sie die Funktionalität, indem Sie sich die 5 Datensätze mit 
den größten Kundennummern
-- ausgeben lassen (SELECT mit ORDER BY + LIMIT). 
SELECT * FROM Kunden
ORDER BY KundenNr DESC LIMIT 5;
-- e) Löschen Sie den Kunden wieder.
DELETE FROM kunden WHERE KundenNr = 497;
-- 3.a) Ausgabe aller Kunden
SELECT * 
FROM Kunden;
-- b) Ausgabe aller Kunden aus den USA
SELECT *
FROM Kunden 
WHERE LAND = 'USA';
-- c) Firmenname und -sitz (=Ort) sowie Kreditlimit der Kunden aus den 
USA mit einem Kreditlimit 
-- zwischen 50000 und 60000 
SELECT Firma, Ort, Kreditlimit
FROM Kunden
WHERE Land = 'USA' AND Kreditlimit >= 50000 AND Kreditlimit <= 60000;
-- d) Ausgabe aller Kunden, für die kein Nachname vermerkt ist.
SELECT *
FROM Kunden
WHERE Nachname IS NULL;
-- e) Ausgabe der verschiedenen Namen der Städte von Kunden aus 
Deutschland ("verschieden" heißt 
-- ohne Duplikate) 
SELECT DISTINCT Ort
FROM Kunden
WHERE Land = 'Deutschland';
-- f) Ausgabe der Kunden aus Deutschland, deren Postleitzahl mit 8 oder 9 
beginnt, sortiert nach Firma 
SELECT *
FROM Kunden
WHERE Land = 'Deutschland' AND (PLZ LIKE '8%' OR PLZ LIKE '9%')
ORDER BY Firma;
-- g) Ausgabe von Name, Ort und Land der Kunden als eine Spalte "Kunde" 
in der Form "<Firmenname>, <Ort> (<Land>)" für alle Kunden. 
-- Also z.B. "Vergnügen & Co., Mannheim (Deutschland)" Hinweis: Texte 
können mit CONCAT oder '||' verkettet werden. 
SELECT CONCAT(Firma, ', ', Ort, ' (', Land, ')') 
FROM Kunden;
-- h) Ausgabe von ArtikelNr, Artikelname und Warengruppennamen für alle 
Artikel. 
SELECT ArtikelNr, Artikelname, GruppenName
FROM Artikel 
JOIN Warengruppen ON Artikel.GruppenNr = Warengruppen.GruppenNr;
-- i) Auftragsnummer und Plantermin für alle Aufträge, die Artikel der 
Warengruppe "Planes" enthalten und deren Status ungleich "Zugestellt" 
ist. 
SELECT Auftraege.AuftragsNr, Auftraege.Plantermin
FROM Auftraege
JOIN Auftragspositionen ON Auftraege.AuftragsNr = 
Auftragspositionen.AuftragsNr
JOIN Artikel ON Auftragspositionen.ArtikelNr = Artikel.ArtikelNr
JOIN Warengruppen ON Artikel.GruppenNr = Warengruppen.GruppenNr
WHERE Warengruppen.GruppenName = 'Planes' AND Auftraege.Status != 
'Zugestellt';
-- 4.a) Versuchen Sie, die Warengruppe 'Ships' zu löschen. Was passiert? 
Begründen Sie!
DELETE FROM Warengruppen WHERE GruppenName = 'Ships';
-- Error Code: 1175. You are using safe update mode and you tried to 
update a table without a WHERE that uses a Key column. 
-- Die Löschung wird verhindert. Es gibt Artikel, die zur Warengruppe 
Ships gehören (da sie in einer anderen Tabelle referenziert wird).
-- b) Ändern Sie die Nummer der Warengruppe "Ships" auf 20. Was passiert 
mit den zugehörigen Artikeln? Begründen Sie!
UPDATE Warengruppen
SET GruppenNr = 20
WHERE GruppenName = 'Ships';
-- Error Code: 1175. You are using safe update mode and you tried to 
update a table without a WHERE that uses a Key column. 
-- Die Datenbank schützt die Datenintegrität. Wenn du die 
Warengruppennummer änderst, aber die Artikel nicht automatisch 
aktualisiert werden, 
-- würden die Artikel auf eine nicht existierende WArengruppe verweisen. 
Daher wird die Änderung blockiert um Fehler zu vermeiden. ( Nur im Safe 
mode)
